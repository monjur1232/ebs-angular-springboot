<div class="container-fluid mt-5">
  <!-- Bulk Attendance Entry Section -->
  <div class="card shadow-lg">
    <div class="card-header text-white" style="background-color: #d702b4;">
      <h2 class="mb-0">Bulk Attendance Entry</h2>
    </div>
    <div class="card-body">
      <form autocomplete="off" #bulkAttForm="ngForm" (ngSubmit)="saveBulkAttendance()">
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Date:</label>
            <input type="date" name="bulkDate" class="form-control" [(ngModel)]="bulkDate" required />
          </div>
          <!-- <div class="col-md-6">
            <label class="form-label">Attendance Code:</label>
            <input type="number" name="bulkAttendanceCode" class="form-control" [(ngModel)]="bulkAttendanceCode" required />
          </div> -->
        </div>

        <div class="mb-3">
          <button type="button" class="btn btn-info me-2" (click)="markAllAsPresent()">
            <i class="bi bi-check-circle"></i> Mark All as Present
          </button>
          <button type="button" class="btn btn-warning me-2" (click)="markAllAsAbsent()">
            <i class="bi bi-x-circle"></i> Mark All as Absent
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetAllTimes()">
            <i class="bi bi-arrow-counterclockwise"></i> Reset All Times
          </button>
        </div>

        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>Employee Code</th>
              <th>Employee Name</th>
              <th>In Time</th>
              <th>Out Time</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emp of employees">
              <td>{{ emp.employeeCode }}</td>
              <td>{{ emp.firstName }} {{ emp.lastName }}</td>
              <td>
                <input type="time" class="form-control" [(ngModel)]="empAttendanceMap[emp.employeeCode].inTime" 
                       [name]="'inTime_' + emp.employeeCode" [disabled]="empAttendanceMap[emp.employeeCode].status === 'Absent'" />
              </td>
              <td>
                <input type="time" class="form-control" [(ngModel)]="empAttendanceMap[emp.employeeCode].outTime" 
                       [name]="'outTime_' + emp.employeeCode" [disabled]="empAttendanceMap[emp.employeeCode].status === 'Absent'" />
              </td>
              <td style="width: 300px;">
                <div class="btn-group btn-group-sm" role="group" style="width: 100%;">
                  <button type="button" class="btn btn-success" 
                          (click)="setStatus(emp.employeeCode, 'Present')"
                          [class.active]="empAttendanceMap[emp.employeeCode].status === 'Present'">
                    Present
                  </button>
                  <button type="button" class="btn btn-warning" 
                          (click)="setStatus(emp.employeeCode, 'Late')"
                          [class.active]="empAttendanceMap[emp.employeeCode].status === 'Late'">
                    Late
                  </button>
                  <button type="button" class="btn btn-danger" 
                          (click)="setStatus(emp.employeeCode, 'Absent')"
                          [class.active]="empAttendanceMap[emp.employeeCode].status === 'Absent'">
                    Absent
                  </button>
                </div>
              </td>
              <td>
                <button type="button" class="btn btn-sm btn-outline-danger" (click)="clearEmployeeAttendance(emp.employeeCode)">
                  <i class="bi bi-trash"></i> Clear
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button type="submit" class="btn btn-success me-md-2">
            <i class="bi bi-save"></i> Save All Attendance
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            <i class="bi bi-x-circle"></i> Reset Form
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Existing Attendance Records Section -->
  <div class="mt-5">
    <h2 class="mb-4 text-center text-primary">Attendance Records</h2>

    <div class="row mb-3">
      <div class="col-md-4">
        <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="searchText" 
               (input)="filterAttendances()">
      </div>
      <div class="col-md-4">
        <input type="date" class="form-control" [(ngModel)]="filterDate" (change)="filterAttendances()">
      </div>
    </div>

    <table class="table table-bordered table-striped text-center align-middle shadow">
      <thead class="table-dark">
        <tr>
          <!-- <th>Attendance Code</th> -->
          <th>Employee Code</th>
          <th>Employee Name</th>
          <th>Date</th>
          <th>In Time</th>
          <th>Out Time</th>
          <th>Status</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let att of filteredAttendances">
          <!-- <td>{{ att.attendanceCode }}</td> -->
          <td>{{ att.employeeCode }}</td>
          <td>{{ att.employeeName }}</td>
          <td>{{ att.date | date }}</td>
          <td>{{ att.inTime }}</td>
          <td>{{ att.outTime }}</td>
          <td>
            <span [ngClass]="{
              'badge bg-success text-white': att.status === 'Present',
              'badge bg-warning': att.status === 'Late',
              'badge bg-danger': att.status === 'Absent'
            }">
              {{ att.status }}
            </span>
          </td>
          <td>
            <button class="btn btn-warning btn-sm" (click)="edit(att)">
              <i class="bi bi-pencil-square"></i> Edit
            </button>
          </td>
          <td>
            <button class="btn btn-danger btn-sm" (click)="delete(att)">
              <i class="bi bi-trash"></i> Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Edit Attendance Modal (Optional - can keep your existing edit form) -->
  <div *ngIf="divStatus" class="mt-5">
    <div class="card shadow-lg">
      <div class="card-header bg-info text-white">
        <h2 class="mb-0">Update Attendance</h2>
      </div>
      <div class="card-body">
        <form autocomplete="off" #attEditForm="ngForm" (ngSubmit)="update(updateAttendance)">
          <input type="hidden" name="id" [(ngModel)]="updateAttendance.id" />
          <div class="row">
            <!-- <div class="col-md-6 mb-3">
              <label class="form-label">Attendance Code:</label>
              <input type="number" name="attendanceCode" class="form-control" [(ngModel)]="updateAttendance.attendanceCode" required />
            </div> -->
            <div class="col-md-6 mb-3">
              <label class="form-label">Select Employee:</label>
              <select name="updateEmployee" class="form-control" (change)="onUpdateEmployeeSelect($event)" required>
                <option value="">-- Select Employee --</option>
                <option *ngFor="let emp of employees" [value]="emp.employeeCode" [selected]="emp.employeeCode === updateAttendance.employeeCode">
                  {{emp.firstName}} {{emp.lastName}} ({{emp.employeeCode}})
                </option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Employee Code:</label>
              <input type="number" name="employeeCode" class="form-control" [(ngModel)]="updateAttendance.employeeCode" readonly />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Employee Name:</label>
              <input type="text" name="employeeName" class="form-control" [(ngModel)]="updateAttendance.employeeName" readonly />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Date:</label>
              <input type="date" name="date" class="form-control" [(ngModel)]="updateAttendance.date" required />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">In Time:</label>
              <input type="time" name="inTime" class="form-control" [(ngModel)]="updateAttendance.inTime" required />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Out Time:</label>
              <input type="time" name="outTime" class="form-control" [(ngModel)]="updateAttendance.outTime" />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Status:</label>
              <select name="status" class="form-control" [(ngModel)]="updateAttendance.status" required>
                <option>Present</option>
                <option>Late</option>
                <option>Absent</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary me-2">
            <i class="bi bi-arrow-repeat"></i> Update
          </button>
          <button type="button" class="btn btn-secondary" (click)="divStatus = false">
            <i class="bi bi-x-circle"></i> Cancel
          </button>
        </form>
      </div>
    </div>
  </div>
</div>